pipeline {

  agent any
  
  environment {

        ANYPOINT_CREDENTIALS = credentials('anypoint.credentials')

      }
	tools {
		maven 'default'
	}

  stages {

	stage('Build'){
		steps {
			sh 'mvn -f mule/pom.xml -DskipTests clean verify compile'
		}
	}

    stage('Test') {

      steps {
        sh 'mvn -f mule/pom.xml test'
      }
    }

    stage('Deploy CloudHub') {
      steps {
	      sh 'mvn -f mule/pom.xml -B -DskipTests package'
	      sh 'mvn -f mule/pom.xml deploy -P cloudhub -Dmule.version=4.2.0 -Danypoint.username=${ANYPOINT_CREDENTIALS_USR} -Danypoint.password=${ANYPOINT_CREDENTIALS_PSW}'
      }
    }
  }
}
